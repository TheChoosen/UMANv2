{% extends "RepubliqueduKwebec/base.html" %}
{% block title %}Mon Profil - Re-Publique Kwébec{% endblock %}
{% block content %}
<div class="container py-4" style="margin-top: 80px;">
  <!-- Section Connexion/Déconnexion -->
  <div id="auth-section" class="mb-4">
    <!-- Formulaire de connexion -->
    <div id="login-form" class="card card-body glass--pro" style="max-width: 400px; margin: 0 auto;">
      <h3 class="text-center mb-4">Connexion Membre</h3>
      <form id="form-login">
        <div class="form-group mb-3">
          <label for="login-email" class="form-label">Email</label>
          <input type="email" class="form-control" id="login-email" name="email" required>
        </div>
        <div class="form-group mb-3">
          <label for="login-password" class="form-label">Mot de passe</label>
          <input type="password" class="form-control" id="login-password" name="password" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Se connecter</button>
        <div id="login-result" class="mt-3"></div>
      </form>
    </div>

    <!-- Zone membre connecté -->
    <div id="member-area" class="d-none">
      <div class="row">
        <div class="col-md-3">
          <!-- Menu de navigation du profil -->
          <div class="card glass--pro">
            <div class="card-header text-center">
              <h5 id="member-name">Mon Profil</h5>
              <button class="btn btn-sm btn-outline-secondary" id="btn-logout">Déconnexion</button>
            </div>
            <div class="list-group list-group-flush">
              <a href="#" class="list-group-item list-group-item-action active" data-section="dashboard">
                <i class="fas fa-dashboard me-2"></i>Tableau de bord
              </a>
              <a href="#" class="list-group-item list-group-item-action" data-section="historique">
                <i class="fas fa-history me-2"></i>Mon Historique
              </a>
              <a href="#" class="list-group-item list-group-item-action" data-section="publications">
                <i class="fas fa-edit me-2"></i>Mes Publications
              </a>
              <a href="#" class="list-group-item list-group-item-action" data-section="decisions">
                <i class="fas fa-vote-yea me-2"></i>Prendre Décisions
              </a>
              <a href="#" class="list-group-item list-group-item-action" data-section="settings">
                <i class="fas fa-cog me-2"></i>Paramètres
              </a>
            </div>
          </div>
        </div>

        <div class="col-md-9">
          <!-- Tableau de bord -->
          <div id="section-dashboard" class="profile-section">
            <div class="card glass--pro">
              <div class="card-header">
                <h4><i class="fas fa-dashboard me-2"></i>Tableau de bord</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title text-primary" id="stats-cercles">0</h5>
                        <p class="card-text">Cercles</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title text-info" id="stats-publications">0</h5>
                        <p class="card-text">Publications</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title text-success" id="stats-decisions">0</h5>
                        <p class="card-text">Décisions</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3 mb-3">
                    <div class="card text-center">
                      <div class="card-body">
                        <h5 class="card-title text-warning" id="stats-adhesions">0</h5>
                        <p class="card-text">Adhésions</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row mt-4">
                  <div class="col-md-6">
                    <h5>Mes Cercles</h5>
                    <div id="dashboard-cercles" class="list-group"></div>
                  </div>
                  <div class="col-md-6">
                    <h5>Mes Rôles</h5>
                    <div id="dashboard-roles" class="list-group"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Historique -->
          <div id="section-historique" class="profile-section d-none">
            <div class="card glass--pro">
              <div class="card-header">
                <h4><i class="fas fa-history me-2"></i>Mon Historique Complet</h4>
              </div>
              <div class="card-body">
                <ul class="nav nav-tabs" id="historique-nav">
                  <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#hist-decisions">Décisions</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#hist-publications">Publications</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#hist-adhesions">Adhésions</a>
                  </li>
                </ul>
                <div class="tab-content mt-3">
                  <div class="tab-pane fade show active" id="hist-decisions">
                    <div class="table-responsive">
                      <table class="table table-hover" id="table-hist-decisions">
                        <thead>
                          <tr>
                            <th>Titre</th>
                            <th>Type</th>
                            <th>Mon Vote</th>
                            <th>Date</th>
                            <th>Statut</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="hist-publications">
                    <div class="table-responsive">
                      <table class="table table-hover" id="table-hist-publications">
                        <thead>
                          <tr>
                            <th>Titre</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Statut</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                  <div class="tab-pane fade" id="hist-adhesions">
                    <div class="table-responsive">
                      <table class="table table-hover" id="table-hist-adhesions">
                        <thead>
                          <tr>
                            <th>Type</th>
                            <th>Date début</th>
                            <th>Date fin</th>
                            <th>Statut</th>
                            <th>Durée</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Publications -->
          <div id="section-publications" class="profile-section d-none">
            <div class="card glass--pro">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h4><i class="fas fa-edit me-2"></i>Mes Publications</h4>
                <button class="btn btn-success" id="btn-new-publication">
                  <i class="fas fa-plus me-2"></i>Nouvelle Publication
                </button>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover" id="table-publications">
                    <thead>
                      <tr>
                        <th>Titre</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Statut</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>

                <!-- Formulaire de publication -->
                <div id="form-publication-container" class="card card-body mt-3 d-none">
                  <h5 id="form-publication-title">Nouvelle Publication</h5>
                  <form id="form-publication">
                    <input type="hidden" id="publication-id" name="id">
                    <div class="row g-3">
                      <div class="col-md-8">
                        <label for="pub-titre" class="form-label">Titre</label>
                        <input type="text" class="form-control" id="pub-titre" name="titre" required>
                      </div>
                      <div class="col-md-4">
                        <label for="pub-type" class="form-label">Type</label>
                        <select class="form-control" id="pub-type" name="type">
                          <option value="article">Article</option>
                          <option value="communique">Communiqué</option>
                          <option value="rapport">Rapport</option>
                          <option value="document">Document</option>
                        </select>
                      </div>
                    </div>

                    <div class="row g-3 mt-3">
                      <div class="col-md-4">
                        <label for="pub-portee" class="form-label">Portée</label>
                        <select id="pub-portee" name="portee" class="form-control">
                          <option value="global" selected>🌍 Global (par défaut)</option>
                          <option value="cercle">🎯 Un de mes cercles</option>
                        </select>
                      </div>
                      <div class="col-md-8">
                        <label for="pub-cercle" class="form-label">Cercle (si applicable)</label>
                        <select id="pub-cercle" name="cercle_id" class="form-control" disabled>
                          <option value="">-- sélectionner un cercle --</option>
                          <!-- options remplies dynamiquement par JS -->
                        </select>
                      </div>
                    </div>

                    <div class="mt-3">
                      <label for="pub-contenu" class="form-label">Contenu</label>
                      <textarea class="form-control" id="pub-contenu" name="contenu" rows="8" required></textarea>
                    </div>
                    <div class="mt-3 d-flex justify-content-end gap-2">
                      <button type="button" class="btn btn-secondary" id="btn-cancel-publication">Annuler</button>
                      <button type="submit" class="btn btn-primary">Publier</button>
                    </div>
                    <div id="publication-result" class="mt-3"></div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Décisions -->
          <div id="section-decisions" class="profile-section d-none">
            <div class="card glass--pro">
              <div class="card-header">
                <h4><i class="fas fa-vote-yea me-2"></i>Prendre des Décisions</h4>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-hover" id="table-decisions-vote">
                    <thead>
                      <tr>
                        <th>Titre</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Date limite</th>
                        <th>Mon vote</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Paramètres -->
          <div id="section-settings" class="profile-section d-none">
            <div class="card glass--pro">
              <div class="card-header">
                <h4><i class="fas fa-cog me-2"></i>Paramètres du compte</h4>
              </div>
              <div class="card-body">
                <form id="form-settings">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="settings-prenom" class="form-label">Prénom</label>
                      <input type="text" class="form-control" id="settings-prenom" name="prenom" required>
                    </div>
                    <div class="col-md-6">
                      <label for="settings-nom" class="form-label">Nom</label>
                      <input type="text" class="form-control" id="settings-nom" name="nom" required>
                    </div>
                  </div>
                  <div class="row g-3 mt-2">
                    <div class="col-md-6">
                      <label for="settings-email" class="form-label">Email</label>
                      <input type="email" class="form-control" id="settings-email" name="email" required>
                    </div>
                    <div class="col-md-6">
                      <label for="settings-telephone" class="form-label">Téléphone</label>
                      <input type="text" class="form-control" id="settings-telephone" name="telephone">
                    </div>
                  </div>
                  <div class="mt-3">
                    <label for="settings-organisation" class="form-label">Organisation</label>
                    <input type="text" class="form-control" id="settings-organisation" name="organisation">
                  </div>

                  <hr class="my-4">
                  <h5>Changer le mot de passe</h5>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="settings-password" class="form-label">Nouveau mot de passe</label>
                      <input type="password" class="form-control" id="settings-password" name="password">
                    </div>
                    <div class="col-md-6">
                      <label for="settings-password-confirm" class="form-label">Confirmer</label>
                      <input type="password" class="form-control" id="settings-password-confirm"
                        name="password_confirm">
                    </div>
                  </div>

                  <div class="mt-3">
                    <button type="submit" class="btn btn-primary">Sauvegarder</button>
                    <div id="settings-result" class="mt-3"></div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour voter sur une décision -->
<div class="modal fade" id="modal-vote" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Voter sur la décision</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="vote-decision-details"></div>
        <form id="form-vote">
          <input type="hidden" id="vote-decision-id" name="decision_id">
          <div class="mb-3">
            <label class="form-label">Votre vote :</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="vote" id="vote-pour" value="pour">
              <label class="form-check-label text-success" for="vote-pour">
                <i class="fas fa-thumbs-up me-2"></i>Pour
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="vote" id="vote-contre" value="contre">
              <label class="form-check-label text-danger" for="vote-contre">
                <i class="fas fa-thumbs-down me-2"></i>Contre
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="vote" id="vote-abstention" value="abstention">
              <label class="form-check-label text-warning" for="vote-abstention">
                <i class="fas fa-minus me-2"></i>Abstention
              </label>
            </div>
          </div>
          <div class="mb-3">
            <label for="vote-commentaire" class="form-label">Commentaire (optionnel)</label>
            <textarea class="form-control" id="vote-commentaire" name="commentaire" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-primary" id="btn-submit-vote">Confirmer le vote</button>
      </div>
    </div>
  </div>
</div>

<script src="/static/RepubliqueduKwebec/rdkq_profil.js"></script>
{% endblock %}
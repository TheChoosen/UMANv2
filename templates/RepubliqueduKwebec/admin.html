{% extends "RepubliqueduKwebec/base.html" %}
{% block title %}Admin RDKQ{% endblock %}
{% block content %}
<div class="container py-4">
  <header class="mb-4 text-center">
  <h1 class="display-4 font-weight-bold">Admin — Re-Publique Kwébec</h1>
    <a href="/rdkq" class="btn btn-link">Retour à l'accueil</a>
  </header>
  <div class="alert alert-info">Authentification requise (prototype, à sécuriser pour la production).</div>
  
  <div class="mb-3">
    <a href="/admin/users" class="btn btn-primary">
      <i class="fas fa-users"></i> Gestion des Utilisateurs
    </a>
    <small class="text-muted ms-2">Gérer les permissions administrateur</small>
  </div>
  
  <div class="row">
    <div class="col-md-3 mb-3">
      <ul class="list-group">
        <li class="list-group-item active" id="tab-membres">Membres</li>
        <li class="list-group-item" id="tab-cercles">Cercles</li>
        <li class="list-group-item" id="tab-roles">Rôles</li>
        <li class="list-group-item" id="tab-decisions">Décisions</li>
        <li class="list-group-item" id="tab-adhesions">Adhésions</li>
        <li class="list-group-item" id="tab-publications">Publications</li>
        <li class="list-group-item" id="tab-participations">Participations</li>
      </ul>
    </div>
    <div class="col-md-9">
      <div id="admin-content" class="card card-body">
        <h2>Gestion des membres</h2>
        <!-- CRUD Membres -->
        <div id="crud-membres">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des membres</h5>
            <button class="btn btn-success btn-sm" id="btn-add-membre">Ajouter un membre</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-membres">
              <thead>
                <tr>
                  <th>Prénom</th>
                  <th>Nom</th>
                  <th>Email</th>
                  <th>Organisation</th>
                  <th>Cercles</th>
                  <th>Rôles</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Membres chargés dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-membre-container" class="card card-body mt-3 d-none">
            <form id="form-membre">
              <input type="hidden" name="id" id="membre-id">
              <div class="row g-2">
                <div class="col-md-4">
                  <input type="text" class="form-control" name="prenom" id="membre-prenom" placeholder="Prénom"
                    required>
                </div>
                <div class="col-md-4">
                  <input type="text" class="form-control" name="nom" id="membre-nom" placeholder="Nom" required>
                </div>
                <div class="col-md-4">
                  <input type="email" class="form-control" name="email" id="membre-email" placeholder="Email" required>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="organisation" id="membre-organisation"
                    placeholder="Organisation">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control" name="telephone" id="membre-telephone"
                    placeholder="Téléphone">
                </div>
              </div>
              
              <!-- Gestion du mot de passe -->
              <div class="mt-3">
                <label class="form-label fw-bold">Authentification</label>
                <div class="row g-2">
                  <div class="col-md-6">
                    <input type="password" class="form-control" name="password" id="membre-password" placeholder="Mot de passe (laisser vide = password123)">
                  </div>
                  <div class="col-md-6">
                    <input type="password" class="form-control" name="password_confirm" id="membre-password-confirm" placeholder="Confirmer le mot de passe">
                  </div>
                </div>
                <small class="text-muted">Si aucun mot de passe n'est défini, le membre utilisera "password123" par défaut</small>
              </div>

              <!-- Gestion des cercles -->
              <div class="mt-3">
                <label class="form-label fw-bold">Cercles de participation</label>
                <div id="membre-cercles-container" class="border rounded p-2">
                  <!-- Cercles chargés dynamiquement -->
                </div>
              </div>

              <!-- Gestion des rôles -->
              <div class="mt-3">
                <label class="form-label fw-bold">Rôles assignés</label>
                <div id="membre-roles-container" class="border rounded p-2">
                  <!-- Rôles chargés dynamiquement -->
                </div>
              </div>

              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-membre">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-membre-result" class="mt-2"></div>
            </form>
          </div>


        </div>
        <!-- CRUD Cercles -->
        <div id="crud-cercles" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des cercles</h5>
            <button class="btn btn-success btn-sm" id="btn-add-cercle">Ajouter un cercle</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-cercles">
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>Description</th>
                  <th>Statut</th>
                  <th>Membres</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Cercles chargés dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-cercle-container" class="card card-body mt-3 d-none">
            <form id="form-cercle">
              <input type="hidden" name="id" id="cercle-id">
              <div class="row g-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="nom" id="cercle-nom" placeholder="Nom du cercle"
                    required>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="statut" id="cercle-statut">
                    <option value="actif">Actif</option>
                    <option value="inactif">Inactif</option>
                    <option value="suspendu">Suspendu</option>
                  </select>
                </div>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="description" id="cercle-description"
                  placeholder="Description du cercle" rows="3"></textarea>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-cercle">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-cercle-result" class="mt-2"></div>
            </form>
          </div>
        </div>

        <!-- CRUD Rôles -->
        <div id="crud-roles" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des rôles</h5>
            <button class="btn btn-success btn-sm" id="btn-add-role">Ajouter un rôle</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-roles">
              <thead>
                <tr>
                  <th>Nom</th>
                  <th>Permissions</th>
                  <th>Niveau</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Rôles chargés dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-role-container" class="card card-body mt-3 d-none">
            <form id="form-role">
              <input type="hidden" name="id" id="role-id">
              <div class="row g-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="nom" id="role-nom" placeholder="Nom du rôle" required>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="niveau" id="role-niveau">
                    <option value="1">Niveau 1 - Membre</option>
                    <option value="2">Niveau 2 - Modérateur</option>
                    <option value="3">Niveau 3 - Administrateur</option>
                    <option value="4">Niveau 4 - Super Admin</option>
                  </select>
                </div>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="permissions" id="role-permissions"
                  placeholder="Permissions (séparées par des virgules)" rows="2"></textarea>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-role">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-role-result" class="mt-2"></div>
            </form>
          </div>
        </div>

        <!-- CRUD Décisions -->
        <div id="crud-decisions" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des décisions</h5>
            <button class="btn btn-success btn-sm" id="btn-add-decision">Ajouter une décision</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-decisions">
              <thead>
                <tr>
                  <th>Titre</th>
                  <th>Type</th>
                  <th>Statut</th>
                  <th>Date vote</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Décisions chargées dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-decision-container" class="card card-body mt-3 d-none">
            <form id="form-decision">
              <input type="hidden" name="id" id="decision-id">
              <div class="row g-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="titre" id="decision-titre"
                    placeholder="Titre de la décision" required>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="type" id="decision-type">
                    <option value="referendum">Référendum</option>
                    <option value="vote_simple">Vote simple</option>
                    <option value="consultation">Consultation</option>
                    <option value="urgence">Urgence</option>
                  </select>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-6">
                  <select class="form-control" name="statut" id="decision-statut">
                    <option value="en_cours">En cours</option>
                    <option value="adoptee">Adoptée</option>
                    <option value="rejetee">Rejetée</option>
                    <option value="suspendue">Suspendue</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <input type="date" class="form-control" name="date_vote" id="decision-date-vote">
                </div>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="description" id="decision-description"
                  placeholder="Description de la décision" rows="3"></textarea>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-decision">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-decision-result" class="mt-2"></div>
            </form>
          </div>
        </div>

        <!-- CRUD Adhésions -->
        <div id="crud-adhesions" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des adhésions</h5>
            <button class="btn btn-success btn-sm" id="btn-add-adhesion">Ajouter une adhésion</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-adhesions">
              <thead>
                <tr>
                  <th>Membre</th>
                  <th>Type</th>
                  <th>Date début</th>
                  <th>Date fin</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Adhésions chargées dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-adhesion-container" class="card card-body mt-3 d-none">
            <form id="form-adhesion">
              <input type="hidden" name="id" id="adhesion-id">
              <div class="row g-2">
                <div class="col-md-6">
                  <select class="form-control" name="membre_id" id="adhesion-membre-id" required>
                    <option value="">Sélectionner un membre</option>
                    <!-- Options chargées dynamiquement -->
                  </select>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="type" id="adhesion-type">
                    <option value="standard">Standard</option>
                    <option value="premium">Premium</option>
                    <option value="famille">Famille</option>
                    <option value="etudiant">Étudiant</option>
                  </select>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-4">
                  <input type="date" class="form-control" name="date_debut" id="adhesion-date-debut" required>
                </div>
                <div class="col-md-4">
                  <input type="date" class="form-control" name="date_fin" id="adhesion-date-fin">
                </div>
                <div class="col-md-4">
                  <select class="form-control" name="statut" id="adhesion-statut">
                    <option value="active">Active</option>
                    <option value="suspendue">Suspendue</option>
                    <option value="expiree">Expirée</option>
                    <option value="annulee">Annulée</option>
                  </select>
                </div>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-adhesion">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-adhesion-result" class="mt-2"></div>
            </form>
          </div>
        </div>

        <!-- CRUD Publications -->
        <div id="crud-publications" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Liste des publications</h5>
            <button class="btn btn-success btn-sm" id="btn-add-publication">Ajouter une publication</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-publications">
              <thead>
                <tr>
                  <th>Titre</th>
                  <th>Type</th>
                  <th>Auteur</th>
                  <th>Date</th>
                  <th>Statut</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Publications chargées dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-publication-container" class="card card-body mt-3 d-none">
            <form id="form-publication">
              <input type="hidden" name="id" id="publication-id">
              <div class="row g-2">
                <div class="col-md-8">
                  <input type="text" class="form-control" name="titre" id="publication-titre"
                    placeholder="Titre de la publication" required>
                </div>
                <div class="col-md-4">
                  <select class="form-control" name="type" id="publication-type">
                    <option value="article">Article</option>
                    <option value="communique">Communiqué</option>
                    <option value="rapport">Rapport</option>
                    <option value="document">Document</option>
                  </select>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="auteur" id="publication-auteur" placeholder="Auteur"
                    required>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="statut" id="publication-statut">
                    <option value="brouillon">Brouillon</option>
                    <option value="publie">Publié</option>
                    <option value="archive">Archivé</option>
                  </select>
                </div>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="contenu" id="publication-contenu"
                  placeholder="Contenu de la publication" rows="4"></textarea>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-publication">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-publication-result" class="mt-2"></div>
            </form>
          </div>
        </div>

        <!-- CRUD Participations -->
        <div id="crud-participations" class="d-none">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">🎯 Liste des participations</h5>
            <button class="btn btn-success btn-sm" id="btn-add-participation">Ajouter une participation</button>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="table-participations">
              <thead>
                <tr>
                  <th>Titre</th>
                  <th>Type</th>
                  <th>Membre</th>
                  <th>Lieu</th>
                  <th>Date</th>
                  <th>Statut</th>
                  <th>Points</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <!-- Participations chargées dynamiquement -->
              </tbody>
            </table>
          </div>
          <div id="form-participation-container" class="card card-body mt-3 d-none">
            <form id="form-participation">
              <input type="hidden" name="id" id="participation-id">
              <div class="row g-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="titre" id="participation-titre"
                    placeholder="Titre de la participation" required>
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="type_participation" id="participation-type">
                    <option value="sommet">Sommet</option>
                    <option value="atelier">Atelier</option>
                    <option value="formation">Formation</option>
                    <option value="mission">Mission</option>
                    <option value="forum">Forum</option>
                    <option value="conference">Conférence</option>
                  </select>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-6">
                  <input type="text" class="form-control" name="lieu" id="participation-lieu" placeholder="Lieu">
                </div>
                <div class="col-md-6">
                  <select class="form-control" name="statut" id="participation-statut">
                    <option value="planifié">Planifié</option>
                    <option value="en-cours">En cours</option>
                    <option value="complété">Complété</option>
                    <option value="annulé">Annulé</option>
                  </select>
                </div>
              </div>
              <div class="row g-2 mt-2">
                <div class="col-md-4">
                  <input type="date" class="form-control" name="date_debut" id="participation-date-debut">
                </div>
                <div class="col-md-4">
                  <input type="date" class="form-control" name="date_fin" id="participation-date-fin">
                </div>
                <div class="col-md-4">
                  <input type="number" class="form-control" name="points_gagne" id="participation-points" 
                    placeholder="Points gagnés" min="0">
                </div>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="description" id="participation-description"
                  placeholder="Description de la participation" rows="3"></textarea>
              </div>
              <div class="mt-2">
                <textarea class="form-control" name="commentaire" id="participation-commentaire"
                  placeholder="Commentaires (optionnel)" rows="2"></textarea>
              </div>
              <div class="mt-3 d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary btn-sm" id="btn-cancel-participation">Annuler</button>
                <button type="submit" class="btn btn-primary btn-sm">Enregistrer</button>
              </div>
              <div id="form-participation-result" class="mt-2"></div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/static/RepubliqueduKwebec/rdkq_admin.js"></script>
{% endblock %}